<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Files - Directory Indexer</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // Inline Modal Logic since we removed settingsModal but checksumsModal might need simple toggle if not in upload.js
        document.addEventListener('DOMContentLoaded', () => {
             const modal = document.getElementById('checksumsModal');
             const btn = document.getElementById('openChecksumsBtn');
             const close = document.getElementById('closeChecksumsBtn');
             
             if(btn) btn.onclick = () => modal.style.display = 'flex';
             if(close) close.onclick = () => modal.style.display = 'none';
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“¤ Upload Evidence</h1>
            <nav>
                <ul>
                    <li><a href="index.html">ğŸ” Search</a></li>
                    <li><a href="upload.html" class="active">ğŸ“¤ Upload</a></li>
                    <li><a href="devices.html">ğŸ“± Devices</a></li>
                    <li><a href="crawler.html">ğŸ¤– Crawler</a></li>
                    <li><a href="settings.html">âš™ï¸ Settings</a></li>
                </ul>
            </nav>
        </header>

        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
            <div style="color: var(--text-secondary);">
                Target Index: <span id="selectedIndexDisplay" style="color: var(--primary-cyan); font-weight: bold;">(none)</span>
            </div>
            <button id="openChecksumsBtn" class="btn">ğŸ” Checksums History</button>
        </div>

        <div class="card upload-section">
            <div class="upload-area" id="uploadArea">
                <input type="file" id="folderInput" webkitdirectory directory multiple style="display:none" />
                <div class="upload-content">
                    <p style="margin-bottom:15px; color:var(--text-secondary)">Drag and drop an evidence folder here</p>
                    <p style="margin-bottom:15px; color:var(--text-secondary)">or</p>
                    <label for="folderInput" class="btn btn-primary">SELECT FOLDER</label>
                </div>
            </div>
            
            <div class="upload-progress" id="uploadProgress" style="display: none; margin-top: 20px; padding: 20px; background: var(--bg-dark); border-radius: 8px; border: 1px solid var(--border-color);">
                <div style="margin-bottom: 12px; font-weight: 600; color: var(--text-primary); font-size: 1.1rem;">ğŸ“¤ Uploading Files</div>
                <div class="progress-bar" style="height: 10px; background-color: var(--bg-hover); border-radius: 5px; overflow: hidden; margin-bottom: 12px;">
                    <div class="progress" id="progressBar" style="height: 100%; background: var(--primary-cyan); width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <span id="uploadStatus" style="color: var(--text-secondary); font-size: 0.95rem;"></span>
            </div>
        </div>

        <div class="tree-section card">
            <h2>Directory Structure</h2>
            <div class="tree-container" style="background: var(--bg-dark); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); max-height: 400px; overflow-y: auto;">
                <div id="treeView" class="tree-view"></div>
            </div>
            <div class="ingest-controls" style="margin-top: 20px; display: flex; justify-content: space-between;">
                <div class="select-controls">
                    <button id="selectAllBtn" class="btn">Select All</button>
                    <button id="deselectAllBtn" class="btn">Deselect All</button>
                </div>
                <button id="ingestBtn" class="btn btn-primary" disabled>INGEST SELECTED FILES</button>
            </div>
        </div>
    </div>

    <!-- Checksums Modal -->
    <div id="checksumsModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center;">
        <div class="card" style="width:900px; max-width:95%; max-height:85%; overflow:hidden; display:flex; flex-direction:column; margin: 5vh auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0;">ğŸ” Uploaded Folder Checksums</h2>
                <button id="refreshChecksumsBtn" class="btn">ğŸ”„ Refresh</button>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                History of all uploaded evidence folders.
            </p>
            <div id="checksumsContent" style="border:1px solid var(--border-color); border-radius:8px; padding:16px; max-height:500px; overflow:auto; background: var(--bg-dark); margin-bottom: 20px;">
                <div style="text-align:center; padding:20px; color:var(--text-secondary);">Loading checksums...</div>
            </div>
            <div style="display:flex; justify-content:flex-end;">
                <button id="closeChecksumsBtn" class="btn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Cookie helper functions
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // Load selected index from cookie
        const selectedIndexDisplay = document.getElementById('selectedIndexDisplay');
        const cachedIndex = getCookie('selectedIndex');
        if (cachedIndex && selectedIndexDisplay) {
            selectedIndexDisplay.textContent = cachedIndex;
        }
    </script>
    <script src="upload.js"></script>
</body>
</html>
