<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crawler Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– <span class="gradient-text">Crawler Dashboard</span></h1>
        <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px; flex-wrap: wrap;">
            <a href="index.html" class="control-btn" style="text-decoration: none;">ğŸ” Search</a>
            <a href="devices.html" class="control-btn" style="text-decoration: none;">ğŸ“± Devices</a>
            <a href="upload.html" class="control-btn" style="text-decoration: none;">ğŸ“¤ Upload</a>
            <a href="settings.html" class="control-btn" style="text-decoration: none;">âš™ï¸ Settings</a>
            <div style="flex: 1; min-width: 200px;">
                <span style="color: #64748b; font-size: 0.9rem;">Selected index:</span>
                <strong id="selectedIndexDisplay" style="color: #2563eb;">(none)</strong>
            </div>
        </div>

        <div class="upload-section">
            <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <h2 style="margin-top: 0;">ğŸ“‚ Uploads Folder Scanner</h2>
                <p style="color: #64748b; margin-bottom: 20px;">
                    The crawler will scan the <code>uploads/</code> folder for device folders and ingest new or modified content into Elasticsearch.
                    Folders that have already been indexed will be skipped automatically.
                </p>
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="forceReindexToggle" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 600; color: #92400e;">âš ï¸ Force Re-index (ignore existing checksums)</span>
                    </label>
                </div>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                    <button id="scanBtn" class="control-btn" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; font-weight: 600; padding: 12px 24px; font-size: 1rem;">
                        ğŸ” Scan Uploads Folder
                    </button>
                    <button id="crawlBtn" class="ingest-btn" style="padding: 12px 24px; font-size: 1rem;" disabled>
                        ğŸ¤– Start Crawling Selected Folders
                    </button>
                    <button id="cleanupBtn" class="control-btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; font-weight: 600; padding: 12px 24px; font-size: 1rem;">
                        ğŸ§¹ Clean Up Temp Folders
                    </button>
                    <span id="folderCount" style="color: #64748b; font-weight: 600;"></span>
                </div>
            </div>

            <div id="progressSection" style="display: none; background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <h3 style="margin-top: 0; color: #1e293b;">âš™ï¸ Crawling Progress</h3>
                <div class="progress-bar" style="height: 24px; background-color: #e2e8f0; border-radius: 12px; overflow: hidden; margin-bottom: 12px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                    <div id="crawlProgressBar" style="height: 100%; background: linear-gradient(90deg, #3b82f6 0%, #10b981 100%); width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <div id="crawlStatus" style="color: #64748b; font-size: 0.95rem; font-weight: 500; margin-bottom: 8px;"></div>
                <div id="crawlDetails" style="max-height: 300px; overflow-y: auto; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; font-size: 0.9rem; font-family: monospace;"></div>
            </div>

            <div id="foldersSection" style="display: none;">
                <h2>ğŸ“ Discovered Folders</h2>
                <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <button id="selectAllFoldersBtn" class="control-btn">Select All</button>
                        <button id="deselectAllFoldersBtn" class="control-btn">Deselect All</button>
                        <button id="selectNewOnlyBtn" class="control-btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; font-weight: 600;">
                            âœ… Select New Only
                        </button>
                    </div>
                    <div id="foldersList" style="max-height: 500px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load selected index from cookie immediately
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        const selectedIndexDisplay = document.getElementById('selectedIndexDisplay');
        const cachedIndex = getCookie('selectedIndex');
        if (cachedIndex && selectedIndexDisplay) {
            selectedIndexDisplay.textContent = cachedIndex;
            selectedIndexDisplay.style.color = '#2563eb';
        }
    </script>
    <script src="crawler.js"></script>
</body>
</html>
